{"version":3,"sources":["observatory/state.cljs"],"mappings":"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","names":["observatory.state/initial-db","re_frame.core.reg_event_db","_","p__12767","vec__12768","cljs.core.nth","db","tab","cljs.core/assoc-in","cljs.core.update_in","cljs.core/not","p__12771","vec__12772","selection","cljs.core.assoc","p__12775","vec__12776","path-segment","cljs.core.update","cljs.core/conj","cljs.core/pop","p__12779","vec__12780","processes","p__12783","vec__12784","hierarchy","iter__5480__auto__","s__12788","cljs.core/LazySeq","temp__5804__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__5478__auto__","size__5479__auto__","cljs.core/count","b__12790","cljs.core/chunk-buffer","i__12789","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__12787","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","i","cljs.core.range","observatory.process.make_process","cljs.core/rand-nth","cljs.core/rand-int","cljs.core.rand","cache-hier","observatory.cache/make-cache-hierarchy","events","s__12792","b__12794","i__12793","iter__12791","cljs.core/vec","js/Date","p__12795","vec__12796","position","p__12799","vec__12800","speed","p__12803","vec__12804","address","map__12807","cljs.core/--destructure-map","cljs.core.get","cache-state","cljs.core.get_in","timestamp","cache","result","observatory.cache/access","re_frame.core.reg_sub","cljs.core.sort_by","cljs.core/>","cljs.core/frequencies","cljs.core.map","observatory.trace/cache-hit-rate","p__12808","vec__12809","drill-path","cljs.core/empty?","cljs.core/chunk-first"],"sourcesContent":["(ns observatory.state\n  \"Re-frame state management for System Observatory.\n\n   The app state is designed for progressive disclosure:\n   - Top level: system overview (processes, memory, etc.)\n   - Drill path: current navigation through data\n   - Selection: what's being inspected\n   - Timeline: trace playback position\"\n  (:require [re-frame.core :as rf]\n            [observatory.process :as process]\n            [observatory.cache :as cache]\n            [observatory.trace :as trace]))\n\n;; =============================================================================\n;; Initial State\n;; =============================================================================\n\n(def initial-db\n  {:view {:current-tab :processes    ; :processes :network :cache :timeline\n          :sidebar-open? true\n          :inspector-open? false}\n\n   ;; Navigation state - where we are in the data hierarchy\n   :drill-path []                     ; e.g., [:processes 0 :memory-regions 2]\n\n   ;; What's currently selected for inspection\n   :selection nil                     ; {:type :process :data {...}}\n\n   ;; System data\n   :system {:processes []\n            :network-connections []\n            :devices []}\n\n   ;; Hardware state\n   :hardware {:cpu-topology nil\n              :cache-hierarchy nil\n              :ram-topology nil}\n\n   ;; Trace data for timeline\n   :trace {:events []\n           :metadata nil\n           :playback {:position 0     ; Current time in ns\n                      :playing? false\n                      :speed 1.0}}\n\n   ;; Simulation state (when not using real data)\n   :simulation {:enabled? true\n                :cache-state nil}})\n\n;; =============================================================================\n;; Event Handlers\n;; =============================================================================\n\n(rf/reg-event-db\n ::initialize\n (fn [_ _]\n   initial-db))\n\n(rf/reg-event-db\n ::set-tab\n (fn [db [_ tab]]\n   (assoc-in db [:view :current-tab] tab)))\n\n(rf/reg-event-db\n ::toggle-sidebar\n (fn [db _]\n   (update-in db [:view :sidebar-open?] not)))\n\n(rf/reg-event-db\n ::toggle-inspector\n (fn [db _]\n   (update-in db [:view :inspector-open?] not)))\n\n;; --- Selection & Drill-down ---\n\n(rf/reg-event-db\n ::select\n (fn [db [_ selection]]\n   (-> db\n       (assoc :selection selection)\n       (assoc-in [:view :inspector-open?] true))))\n\n(rf/reg-event-db\n ::drill-into\n (fn [db [_ path-segment]]\n   (update db :drill-path conj path-segment)))\n\n(rf/reg-event-db\n ::drill-up\n (fn [db _]\n   (update db :drill-path pop)))\n\n(rf/reg-event-db\n ::drill-reset\n (fn [db _]\n   (assoc db :drill-path [])))\n\n;; --- Data Loading ---\n\n(rf/reg-event-db\n ::set-processes\n (fn [db [_ processes]]\n   (assoc-in db [:system :processes] processes)))\n\n(rf/reg-event-db\n ::set-cache-hierarchy\n (fn [db [_ hierarchy]]\n   (-> db\n       (assoc-in [:hardware :cache-hierarchy] hierarchy)\n       (assoc-in [:simulation :cache-state] hierarchy))))\n\n;; --- Sample Data (for development) ---\n\n(rf/reg-event-db\n ::load-sample-data\n (fn [db _]\n   (let [;; Generate sample processes\n         processes (for [i (range 25)]\n                     (process/make-process\n                      (+ 1000 (* i 100))\n                      (rand-nth [\"chrome.exe\" \"firefox.exe\" \"code.exe\"\n                                 \"explorer.exe\" \"System\" \"svchost.exe\"\n                                 \"dwm.exe\" \"node.exe\" \"rust-analyzer.exe\"\n                                 \"wsl.exe\" \"docker.exe\" \"spotify.exe\"])\n                      :ppid (when (> i 0) (+ 1000 (* (rand-int i) 100)))\n                      :memory-bytes (rand-int (* 2 1024 1024 1024))\n                      :cpu-percent (* (rand) 25.0)\n                      :threads (inc (rand-int 100))))\n\n         ;; Create cache hierarchy\n         cache-hier (cache/make-cache-hierarchy\n                     {:l1d {:size-kb 32 :associativity 8 :type :data}\n                      :l2 {:size-kb 256 :associativity 4 :type :unified}\n                      :l3 {:size-kb 8192 :associativity 16 :type :unified}})\n\n         ;; Generate some trace events\n         events (for [i (range 100)]\n                  {:timestamp (* i 1000)\n                   :type (rand-nth [:cache-hit :cache-hit :cache-hit :cache-miss\n                                    :page-fault :disk-read])\n                   :pid (+ 1000 (* (rand-int 5) 100))\n                   :tid 1\n                   :address (+ 0x7ff600000000 (rand-int 0x10000000))\n                   :level (rand-nth [:l1 :l1 :l2 :l3])})]\n\n     (-> db\n         (assoc-in [:system :processes] (vec processes))\n         (assoc-in [:hardware :cache-hierarchy] cache-hier)\n         (assoc-in [:simulation :cache-state] cache-hier)\n         (assoc-in [:trace :events] (vec events))\n         (assoc-in [:trace :metadata] {:start-time (str (js/Date.))\n                                       :event-count (count events)\n                                       :duration-ns 100000})))))\n\n;; --- Timeline Playback ---\n\n(rf/reg-event-db\n ::set-playback-position\n (fn [db [_ position]]\n   (assoc-in db [:trace :playback :position] position)))\n\n(rf/reg-event-db\n ::toggle-playback\n (fn [db _]\n   (update-in db [:trace :playback :playing?] not)))\n\n(rf/reg-event-db\n ::set-playback-speed\n (fn [db [_ speed]]\n   (assoc-in db [:trace :playback :speed] speed)))\n\n;; --- Cache Simulation ---\n\n(rf/reg-event-db\n ::simulate-access\n (fn [db [_ address]]\n   (let [cache-state (get-in db [:simulation :cache-state])\n         timestamp (get-in db [:trace :playback :position])\n         {:keys [cache result]} (cache/access\n                                 (get cache-state :l1d)\n                                 address\n                                 timestamp)]\n     (-> db\n         (assoc-in [:simulation :cache-state :l1d] cache)\n         (update-in [:trace :events] conj\n                    {:timestamp timestamp\n                     :type (if (:hit? result) :cache-hit :cache-miss)\n                     :address address\n                     :level :l1\n                     :set-index (:set-index result)\n                     :way-index (:way-index result)})))))\n\n;; =============================================================================\n;; Subscriptions\n;; =============================================================================\n\n(rf/reg-sub ::view (fn [db _] (:view db)))\n(rf/reg-sub ::current-tab (fn [db _] (get-in db [:view :current-tab])))\n(rf/reg-sub ::sidebar-open? (fn [db _] (get-in db [:view :sidebar-open?])))\n(rf/reg-sub ::inspector-open? (fn [db _] (get-in db [:view :inspector-open?])))\n\n(rf/reg-sub ::drill-path (fn [db _] (:drill-path db)))\n(rf/reg-sub ::selection (fn [db _] (:selection db)))\n\n(rf/reg-sub ::processes (fn [db _] (get-in db [:system :processes])))\n(rf/reg-sub ::network-connections (fn [db _] (get-in db [:system :network-connections])))\n\n(rf/reg-sub ::cache-hierarchy (fn [db _] (get-in db [:hardware :cache-hierarchy])))\n(rf/reg-sub ::cache-state (fn [db _] (get-in db [:simulation :cache-state])))\n\n(rf/reg-sub ::trace-events (fn [db _] (get-in db [:trace :events])))\n(rf/reg-sub ::trace-metadata (fn [db _] (get-in db [:trace :metadata])))\n(rf/reg-sub ::playback (fn [db _] (get-in db [:trace :playback])))\n\n;; Derived subscriptions\n\n(rf/reg-sub\n ::processes-by-cpu\n :<- [::processes]\n (fn [processes _]\n   (sort-by :cpu-percent > processes)))\n\n(rf/reg-sub\n ::processes-by-memory\n :<- [::processes]\n (fn [processes _]\n   (sort-by :memory-bytes > processes)))\n\n(rf/reg-sub\n ::trace-summary\n :<- [::trace-events]\n (fn [events _]\n   (when (seq events)\n     {:total (count events)\n      :by-type (frequencies (map :type events))\n      :hit-rate (trace/cache-hit-rate events)})))\n\n(rf/reg-sub\n ::current-data\n :<- [::processes]\n :<- [::drill-path]\n (fn [[processes drill-path] _]\n   ;; Navigate to current position in data hierarchy\n   (if (empty? drill-path)\n     {:type :root :data {:processes processes}}\n     (get-in {:processes processes} drill-path))))\n"]}