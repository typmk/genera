{"version":3,"sources":["observatory/views/timeline.cljs"],"mappings":"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","names":["observatory.views.timeline/format-time","ns","observatory.views.timeline/playback-controls","cljs.core/deref","p1__12926#","playback","re_frame.core.subscribe","metadata","re-frame.core/dispatch","js/parseFloat","observatory.views.timeline/scrubber","position","duration","pct","e","rect","x","width","new-pct","new-pos","p__12927","map__12928","cljs.core/--destructure-map","cljs.core.get","observatory.views.timeline/event-marker","event","on-click","cljs.core/name","p__12929","map__12930","observatory.views.timeline/event-lane","label","events","on-event-click","iter__5480__auto__","s__12932","cljs.core/LazySeq","temp__5804__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__5478__auto__","size__5479__auto__","cljs.core/count","b__12934","cljs.core/chunk-buffer","i__12933","vec__12935","cljs.core/-nth","cljs.core.nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__12931","cljs.core/chunk-rest","vec__12938","cljs.core/first","cljs.core/cons","cljs.core/rest","idx","cljs.core.map_indexed","cljs.core/vector","observatory.views.timeline/event-lanes","cpu-events","p1__12941#","cljs.core.filter","G__12948","fexpr__12947","l1-events","p1__12942#","and__5000__auto__","G__12950","fexpr__12949","cljs.core._EQ_","l2-events","p1__12943#","G__12952","fexpr__12951","l3-events","p1__12944#","G__12954","fexpr__12953","ram-events","p1__12945#","G__12956","fexpr__12955","disk-events","p1__12946#","G__12958","fexpr__12957","handle-click","observatory.views.timeline/current-event-info","nearest","p1__12959#","cljs.core.sort_by","cljs.core/>","observatory.views.timeline/trace-summary","summary","s__12961","b__12963","i__12962","vec__12964","iter__12960","vec__12967","event-type","count","hit-rate","observatory.views.timeline/timeline-view","cljs.core/chunk-first"],"sourcesContent":["(ns observatory.views.timeline\n  \"Timeline view for trace playback.\n\n   Shows events over time with:\n   - Scrubber to move through time\n   - Event lanes (CPU, L1, L2, L3, RAM, Disk)\n   - Speed control (slow down nanoseconds to seconds)\n   - Click events to inspect\"\n  (:require [re-frame.core :as rf]\n            [observatory.state :as state]\n            [observatory.trace :as trace]))\n\n;; =============================================================================\n;; Time Formatting\n;; =============================================================================\n\n(defn format-time\n  \"Format nanoseconds as human-readable time.\"\n  [ns]\n  (cond\n    (< ns 1000) (str ns \"ns\")\n    (< ns 1000000) (str (.toFixed (/ ns 1000) 1) \"\u03bcs\")\n    (< ns 1000000000) (str (.toFixed (/ ns 1000000) 2) \"ms\")\n    :else (str (.toFixed (/ ns 1000000000) 3) \"s\")))\n\n;; =============================================================================\n;; Playback Controls\n;; =============================================================================\n\n(defn playback-controls\n  \"Transport controls for timeline playback.\"\n  []\n  (let [playback @(rf/subscribe [::state/playback])\n        metadata @(rf/subscribe [::state/trace-metadata])]\n    [:div.playback-controls\n     [:div.transport\n      [:button.transport-btn {:on-click #(rf/dispatch [::state/set-playback-position 0])}\n       \"\u23ee\"]\n      [:button.transport-btn \"\u23ea\"]\n      [:button.transport-btn.play\n       {:on-click #(rf/dispatch [::state/toggle-playback])}\n       (if (:playing? playback) \"\u23f8\" \"\u25b6\")]\n      [:button.transport-btn \"\u23e9\"]\n      [:button.transport-btn\n       {:on-click #(rf/dispatch [::state/set-playback-position\n                                 (:duration-ns metadata 0)])}\n       \"\u23ed\"]]\n\n     [:div.time-display\n      [:span.current (format-time (:position playback 0))]\n      [:span.sep \" / \"]\n      [:span.total (format-time (:duration-ns metadata 0))]]\n\n     [:div.speed-control\n      [:span.label \"Speed:\"]\n      [:select.speed-select\n       {:value (:speed playback)\n        :on-change #(rf/dispatch [::state/set-playback-speed\n                                  (js/parseFloat (-> % .-target .-value))])}\n       [:option {:value 0.001} \"0.001x (ns\u2192ms)\"]\n       [:option {:value 0.01} \"0.01x\"]\n       [:option {:value 0.1} \"0.1x\"]\n       [:option {:value 1} \"1x (real-time)\"]\n       [:option {:value 10} \"10x\"]]]]))\n\n;; =============================================================================\n;; Scrubber\n;; =============================================================================\n\n(defn scrubber\n  \"Timeline scrubber - drag to move through time.\"\n  []\n  (let [playback @(rf/subscribe [::state/playback])\n        metadata @(rf/subscribe [::state/trace-metadata])\n        position (:position playback 0)\n        duration (:duration-ns metadata 1)\n        pct (* 100 (/ position duration))]\n    [:div.scrubber\n     [:div.scrubber-track\n      {:on-click (fn [e]\n                   (let [rect (-> e .-target .getBoundingClientRect)\n                         x (- (.-clientX e) (.-left rect))\n                         width (.-width rect)\n                         new-pct (/ x width)\n                         new-pos (* new-pct duration)]\n                     (rf/dispatch [::state/set-playback-position (int new-pos)])))}\n      [:div.scrubber-fill {:style {:width (str pct \"%\")}}]\n      [:div.scrubber-handle {:style {:left (str pct \"%\")}}]]\n\n     [:div.time-markers\n      [:span.marker \"0\"]\n      [:span.marker (format-time (/ duration 4))]\n      [:span.marker (format-time (/ duration 2))]\n      [:span.marker (format-time (* 3 (/ duration 4)))]\n      [:span.marker (format-time duration)]]]))\n\n;; =============================================================================\n;; Event Lanes\n;; =============================================================================\n\n(defn event-marker\n  \"A single event marker on a lane.\"\n  [{:keys [event position duration on-click]}]\n  (let [pct (* 100 (/ (:timestamp event) duration))]\n    [:div.event-marker\n     {:class [(name (:type event))\n              (when (:hit? event) \"hit\")\n              (when-not (:hit? event) \"miss\")]\n      :style {:left (str pct \"%\")}\n      :on-click #(on-click event)\n      :title (str (:type event) \" @ \" (format-time (:timestamp event)))}]))\n\n(defn event-lane\n  \"A single event lane (e.g., CPU, L1, L2).\"\n  [{:keys [label events duration on-event-click]}]\n  [:div.event-lane\n   [:div.lane-label label]\n   [:div.lane-track\n    (for [[idx event] (map-indexed vector events)]\n      ^{:key idx}\n      [event-marker {:event event\n                     :position (:timestamp event)\n                     :duration duration\n                     :on-click on-event-click}])]])\n\n(defn event-lanes\n  \"All event lanes stacked vertically.\"\n  []\n  (let [events @(rf/subscribe [::state/trace-events])\n        metadata @(rf/subscribe [::state/trace-metadata])\n        duration (:duration-ns metadata 1)\n\n        ;; Group events by type/level\n        cpu-events (filter #(#{:instruction-sample :context-switch} (:type %)) events)\n        l1-events (filter #(and (#{:cache-hit :cache-miss} (:type %))\n                                (= :l1 (:level %))) events)\n        l2-events (filter #(and (#{:cache-hit :cache-miss} (:type %))\n                                (= :l2 (:level %))) events)\n        l3-events (filter #(and (#{:cache-hit :cache-miss} (:type %))\n                                (= :l3 (:level %))) events)\n        ram-events (filter #(#{:page-fault} (:type %)) events)\n        disk-events (filter #(#{:disk-read :disk-write} (:type %)) events)\n\n        handle-click (fn [event]\n                       (rf/dispatch [::state/select {:type :trace-event :data event}]))]\n\n    [:div.event-lanes\n     [event-lane {:label \"CPU\" :events cpu-events :duration duration\n                  :on-event-click handle-click}]\n     [event-lane {:label \"L1\" :events l1-events :duration duration\n                  :on-event-click handle-click}]\n     [event-lane {:label \"L2\" :events l2-events :duration duration\n                  :on-event-click handle-click}]\n     [event-lane {:label \"L3\" :events l3-events :duration duration\n                  :on-event-click handle-click}]\n     [event-lane {:label \"RAM\" :events ram-events :duration duration\n                  :on-event-click handle-click}]\n     [event-lane {:label \"Disk\" :events disk-events :duration duration\n                  :on-event-click handle-click}]]))\n\n;; =============================================================================\n;; Current Event Info\n;; =============================================================================\n\n(defn current-event-info\n  \"Shows info about event at current playback position.\"\n  []\n  (let [events @(rf/subscribe [::state/trace-events])\n        playback @(rf/subscribe [::state/playback])\n        position (:position playback 0)\n\n        ;; Find event nearest to current position\n        nearest (->> events\n                     (filter #(<= (:timestamp %) position))\n                     (sort-by :timestamp >)\n                     first)]\n    [:div.current-event-info\n     (if nearest\n       [:div.event-detail\n        [:span.event-type (str (:type nearest))]\n        [:span.event-time (format-time (:timestamp nearest))]\n        (when (:address nearest)\n          [:span.event-addr (str \"@ 0x\" (.toString (:address nearest) 16))])\n        (when (:level nearest)\n          [:span.event-level (str (:level nearest))])]\n       [:div.no-event \"No event at this position\"])]))\n\n;; =============================================================================\n;; Trace Summary\n;; =============================================================================\n\n(defn trace-summary\n  \"Summary statistics for the current trace.\"\n  []\n  (let [summary @(rf/subscribe [::state/trace-summary])]\n    (when summary\n      [:div.trace-summary\n       [:div.summary-stat\n        [:span.value (:total summary)]\n        [:span.label \"Events\"]]\n\n       (for [[event-type count] (:by-type summary)]\n         ^{:key event-type}\n         [:div.summary-stat\n          [:span.value count]\n          [:span.label (name event-type)]])\n\n       (when-let [hit-rate (:hit-rate summary)]\n         [:div.summary-stat.highlight\n          [:span.value (str (int (* 100 (:hit-rate hit-rate))) \"%\")]\n          [:span.label \"Cache Hit Rate\"]])])))\n\n;; =============================================================================\n;; Main Timeline View\n;; =============================================================================\n\n(defn timeline-view\n  \"Complete timeline view with all components.\"\n  []\n  [:div.timeline-view\n   [:div.view-header\n    [:h2 \"Timeline\"]\n    [:p.hint \"Scrub through trace events. Slow down time to see cache behavior.\"]]\n\n   [trace-summary]\n\n   [:div.timeline-main\n    [playback-controls]\n    [scrubber]\n    [event-lanes]\n    [current-event-info]]])\n"]}